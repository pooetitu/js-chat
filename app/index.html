<!DOCTYPE html>
<html>
  <head>
    <title>Chat test</title>
  </head>
  <body>
    <textarea id="chat-box"></textarea>
    <form id="form">
      <input id="text" type="text" />
      <button id="submit">send</button>
    </form>
    <script>
      window.addEventListener("load", pageReady);
      var exampleSocket;
      function pageReady() {
        exampleSocket = new WebSocket("ws://localhost:3000", "protocolOne");
        document.getElementById("submit").addEventListener("click", (e) => {
          e.preventDefault();
          sendText();
        });
        exampleSocket.onmessage = (event) => {
          document.getElementById("chat-box").value += JSON.parse(event).text;
          console.log(JSON.parse(event).text);
        };
      }
      function sendText() {
        var msg = {
          type: "message",
          text: document.getElementById("text").value,
          date: Date.now(),
        };
        exampleSocket.send(JSON.stringify(msg));
        document.getElementById("text").value = "";
      }
    </script>
  </body>
</html>
